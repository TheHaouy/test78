<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thanh To√°n ƒê∆°n H√†ng</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root {
      --primary-green: #2e7d32;
      --accent-green: #4caf50;
      --light-green: #81c784;
      --soft-green: #a5d6a7;
      --light-bg: #e8f5e8;
      --very-light-bg: #f1f8e9;
      --text-dark: #1b5e20;
      --border-green: #c8e6c9;
      --shadow-green: rgba(46, 125, 50, 0.15);
      --gradient-green: linear-gradient(135deg, #2e7d32, #4caf50);
    }

    body {
      background: linear-gradient(135deg, #e8f5e8 0%, #f1f8e9 50%, #e0f2e0 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: var(--text-dark);
      min-height: 100vh;
    }

    .address-card {
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      background: linear-gradient(145deg, rgba(255,255,255,0.95), rgba(248,255,248,0.9));
      border: 2px solid var(--border-green);
      backdrop-filter: blur(10px);
    }
    
    .address-card:hover {
      border-color: var(--accent-green);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px var(--shadow-green);
    }

    .address-card.selected {
      border-color: var(--primary-green) !important;
      background: linear-gradient(145deg, rgba(200,230,201,0.2), rgba(232,245,232,0.3)) !important;
      box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1) !important;
    }

    .payment-method {
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      background: linear-gradient(145deg, rgba(255,255,255,0.95), rgba(248,255,248,0.9));
      border: 2px solid var(--border-green);
      backdrop-filter: blur(10px);
    }
    
    .payment-method:hover {
      background: linear-gradient(145deg, rgba(240,255,240,0.95), rgba(232,245,232,0.9));
      border-color: var(--accent-green);
      transform: translateY(-1px);
    }

    .payment-method.selected {
      border-color: var(--primary-green) !important;
      background: linear-gradient(145deg, rgba(200,230,201,0.2), rgba(232,245,232,0.3)) !important;
    }

    .btn-pay {
      background: var(--gradient-green);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: none;
      box-shadow: 0 6px 20px rgba(46, 125, 50, 0.3);
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: 700;
    }
    
    .btn-pay:hover {
      background: linear-gradient(135deg, #43a047, #66bb6a);
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 12px 30px rgba(46, 125, 50, 0.4);
    }

    .btn-pay:active {
      transform: translateY(-1px) scale(0.98);
      box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
    }

    .product-item {
      border-bottom: 1px solid var(--border-green);
      padding: 16px 0;
      transition: all 0.3s ease;
    }

    .product-item:hover {
      background: rgba(232, 245, 232, 0.3);
      border-radius: 8px;
      padding-left: 8px;
      padding-right: 8px;
    }

    .section-card {
      background: linear-gradient(145deg, rgba(255,255,255,0.95), rgba(248,255,248,0.85));
      border: 2px solid var(--border-green);
      box-shadow: 0 8px 25px var(--shadow-green);
      backdrop-filter: blur(15px);
      border-radius: 16px;
      transition: all 0.3s ease;
    }

    .section-card:hover {
      box-shadow: 0 12px 35px rgba(46, 125, 50, 0.2);
      transform: translateY(-2px);
    }

    .order-summary-card {
      background: linear-gradient(145deg, rgba(255,255,255,0.98), rgba(240,255,240,0.9));
      border: 2px solid var(--soft-green);
      box-shadow: 0 10px 30px var(--shadow-green);
      backdrop-filter: blur(15px);
      border-radius: 18px;
      position: sticky;
      top: 24px;
    }

    .form-control {
      border: 2px solid var(--border-green) !important;
      border-radius: 12px !important;
      padding: 12px 16px !important;
      background: linear-gradient(to bottom, rgba(255,255,255,0.9), rgba(248,255,248,0.7)) !important;
      transition: all 0.3s ease !important;
      font-weight: 500 !important;
    }

    .form-control:focus {
      outline: none !important;
      border-color: var(--primary-green) !important;
      box-shadow: 0 0 0 4px rgba(46, 125, 50, 0.15) !important;
      background: rgba(255,255,255,0.95) !important;
      transform: translateY(-1px);
    }

    .btn-success {
      background: var(--gradient-green) !important;
      border: none !important;
      border-radius: 12px !important;
      padding: 12px 24px !important;
      font-weight: 600 !important;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      transition: all 0.3s ease !important;
      box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3) !important;
    }

    .btn-success:hover {
      background: linear-gradient(135deg, #43a047, #66bb6a) !important;
      transform: translateY(-2px) scale(1.02) !important;
      box-shadow: 0 8px 25px rgba(46, 125, 50, 0.4) !important;
    }

    .btn-outline-secondary {
      border: 2px solid #9e9e9e !important;
      color: #757575 !important;
      border-radius: 12px !important;
      padding: 12px 24px !important;
      font-weight: 600 !important;
      transition: all 0.3s ease !important;
    }

    .btn-outline-secondary:hover {
      background: #f5f5f5 !important;
      border-color: #757575 !important;
      transform: translateY(-1px) !important;
    }

    .modal-backdrop {
      background: rgba(46, 125, 50, 0.25) !important;
      backdrop-filter: blur(8px);
    }

    .modal-content {
      background: linear-gradient(145deg, rgba(255,255,255,0.98), rgba(248,255,248,0.95)) !important;
      border: 3px solid var(--accent-green) !important;
      border-radius: 20px !important;
      box-shadow: 0 25px 80px rgba(46, 125, 50, 0.3) !important;
      backdrop-filter: blur(15px);
    }

    .section-header {
      color: var(--primary-green);
      font-weight: 700;
      font-size: 1.3rem;
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .section-header i {
      color: var(--accent-green);
      margin-right: 12px;
      font-size: 1.1rem;
    }

    .add-address-btn {
      color: var(--primary-green) !important;
      font-weight: 600;
      transition: all 0.3s ease;
      padding: 8px 16px;
      border-radius: 8px;
      background: rgba(232, 245, 232, 0.3);
      text-decoration: none !important;
    }

    .add-address-btn:hover {
      background: rgba(200, 230, 201, 0.4);
      transform: translateX(5px);
      color: var(--accent-green) !important;
    }

    .delete-btn {
      color: #d32f2f;
      transition: all 0.3s ease;
      padding: 8px;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .delete-btn:hover {
      background: rgba(211, 47, 47, 0.1);
      color: #b71c1c;
      transform: scale(1.1);
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-fade-in {
      animation: fadeInUp 0.5s ease forwards;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .section-card {
        margin: 16px;
        border-radius: 12px;
      }
      
      .order-summary-card {
        position: static;
        margin: 16px;
        border-radius: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="container mx-auto px-4 py-8 max-w-6xl">
    <!-- Th√™m n√∫t quay l·∫°i -->
    <div class="mb-6">
      <button id="backToCartBtn" class="flex items-center px-6 py-3 rounded-xl font-semibold transition-all duration-300" style="background: rgba(232, 245, 232, 0.5); color: var(--primary-green); border: 2px solid var(--border-green);">
        <i class="fas fa-arrow-left mr-2"></i>
        Quay l·∫°i gi·ªè h√†ng
      </button>
    </div>

    <header class="mb-12 text-center animate-fade-in">
      <h1 class="text-4xl font-bold" style="color: var(--primary-green); text-shadow: 0 2px 4px rgba(46, 125, 50, 0.1);">üåø Thanh To√°n ƒê∆°n H√†ng</h1>
      <p class="text-lg mt-3" style="color: var(--text-dark);">Vui l√≤ng ki·ªÉm tra th√¥ng tin ƒë∆°n h√†ng tr∆∞·ªõc khi x√°c nh·∫≠n</p>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <div class="lg:col-span-2 space-y-8">
        <!-- ƒê·ªãa ch·ªâ giao h√†ng -->
        <section class="section-card p-8">
          <h2 class="section-header">
            <i class="fas fa-map-marker-alt"></i>
            ƒê·ªãa Ch·ªâ Giao H√†ng
          </h2>

          <div id="addressList" class="space-y-4 mb-6">
            <!-- ƒê·ªãa ch·ªâ m·ªõi s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y -->
          </div>

          <button id="addAddressBtn" class="add-address-btn flex items-center">
            <i class="fas fa-plus-circle mr-2"></i>
            Th√™m ƒë·ªãa ch·ªâ m·ªõi
          </button>
        </section>

        <!-- Ph∆∞∆°ng th·ª©c thanh to√°n -->
        <section class="section-card p-8">
          <h2 class="section-header">
            <i class="fas fa-credit-card"></i>
            Ph∆∞∆°ng Th·ª©c Thanh To√°n
          </h2>

          <div class="space-y-4">
            <label class="payment-method flex items-center space-x-4 p-6 rounded-xl cursor-pointer">
              <input type="radio" name="payment" class="h-6 w-6 text-green-600" checked>
              <div class="flex-1">
                <div class="flex items-center">
                  <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/5aca320a-1b9c-46af-9ae1-299451095a87.png" alt="MoMo" class="h-12 w-12 object-contain mr-4">
                  <p class="font-semibold text-lg" style="color: var(--primary-green);">V√≠ ƒëi·ªán t·ª≠ MoMo</p>
                </div>
                <p class="text-sm mt-2" style="color: var(--text-dark); opacity: 0.8;">Thanh to√°n nhanh ch√≥ng v√† b·∫£o m·∫≠t v·ªõi v√≠ MoMo</p>
              </div>
            </label>

            <label class="payment-method flex items-center space-x-4 p-6 rounded-xl cursor-pointer">
              <input type="radio" name="payment" class="h-6 w-6 text-green-600">
              <div class="flex-1">
                <div class="flex items-center">
                  <i class="fas fa-money-bill-wave text-2xl mr-4" style="color: var(--accent-green);"></i>
                  <p class="font-semibold text-lg" style="color: var(--primary-green);">Thanh to√°n khi nh·∫≠n h√†ng (COD)</p>
                </div>
                <p class="text-sm mt-2" style="color: var(--text-dark); opacity: 0.8;">Nh·∫≠n h√†ng v√† thanh to√°n b·∫±ng ti·ªÅn m·∫∑t</p>
              </div>
            </label>
          </div>
        </section>
      </div>

      <!-- T√≥m t·∫Øt ƒë∆°n h√†ng -->
      <div class="order-summary-card p-8">
        <h2 class="section-header">
          <i class="fas fa-receipt"></i>
          Th√¥ng Tin ƒê∆°n H√†ng
        </h2>

        <div class="mb-6 max-h-80 overflow-y-auto" id="orderItemsContainer">
            <!-- S·∫£n ph·∫©m s·∫Ω ƒë∆∞·ª£c render b·∫±ng JS -->
        </div>

        <div class="space-y-4 border-t pt-6 order-summary" style="border-color: var(--border-green);">
          <div class="flex justify-between text-lg">
            <p style="color: var(--text-dark);">T·∫°m t√≠nh:</p>
            <p style="color: var(--primary-green); font-weight: 600;">0‚Ç´</p>
          </div>
          <div class="flex justify-between text-lg">
            <p style="color: var(--text-dark);">Ph√≠ v·∫≠n chuy·ªÉn:</p>
            <p style="color: var(--primary-green); font-weight: 600;">30.000‚Ç´</p>
          </div>
          <div class="flex justify-between font-bold text-xl pt-4 border-t" style="border-color: var(--border-green);">
            <p style="color: var(--primary-green);">T·ªïng c·ªông:</p>
            <p style="color: var(--accent-green); font-size: 1.3rem;">0‚Ç´</p>
          </div>
        </div>

        <button id="completeOrderBtn" class="btn-pay w-full py-4 text-white font-bold rounded-xl mt-8 focus:outline-none focus:ring-4 focus:ring-green-200">
          <i class="fas fa-check-circle mr-2"></i>
          HO√ÄN T·∫§T ƒê∆†N H√ÄNG
        </button>
      </div>
    </div>
  </div>

  <!-- Modal th√™m ƒë·ªãa ch·ªâ -->
  <div id="addressModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 px-4">
    <div class="modal-content w-full max-w-lg">
      <div class="flex justify-between items-center mb-6 p-6 pb-0">
        <h3 class="text-2xl font-bold" style="color: var(--primary-green);">
          <i class="fas fa-plus-circle mr-2" style="color: var(--accent-green);"></i>
          Th√™m ƒë·ªãa ch·ªâ m·ªõi
        </h3>
        <button id="closeModalBtn" class="delete-btn">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <form id="addressForm" class="space-y-5 p-6 pt-0">
        <div>
          <label class="block font-semibold mb-2" style="color: var(--primary-green);">
            <i class="fas fa-tag mr-2"></i>T√™n g·ª£i nh·ªõ (kh√¥ng b·∫Øt bu·ªôc)
          </label>
          <input type="text" id="inputNickname" class="form-control" placeholder="V√≠ d·ª•: Nh√† ri√™ng, C√¥ng ty, Nh√† b·∫°n b√®...">
        </div>
        <div>
          <label class="block font-semibold mb-2" style="color: var(--primary-green);">
            <i class="fas fa-user mr-2"></i>H·ªç v√† t√™n
          </label>
          <input type="text" id="inputName" class="form-control" placeholder="Nh·∫≠p h·ªç v√† t√™n">
        </div>
        <div>
          <label class="block font-semibold mb-2" style="color: var(--primary-green);">
            <i class="fas fa-phone mr-2"></i>S·ªë ƒëi·ªán tho·∫°i
          </label>
          <input type="tel" id="inputPhone" class="form-control" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">
        </div>
        <div>
          <label class="block font-semibold mb-2" style="color: var(--primary-green);">
            <i class="fas fa-home mr-2"></i>ƒê·ªãa ch·ªâ
          </label>
          <input type="text" id="inputAddress" class="form-control" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ c·ª• th·ªÉ">
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block font-semibold mb-2" style="color: var(--primary-green);">
              <i class="fas fa-city mr-2"></i>T·ªânh/Th√†nh ph·ªë
            </label>
            <input type="text" id="inputCity" class="form-control" placeholder="Nh·∫≠p t·ªânh/th√†nh ph·ªë">
          </div>
          <div>
            <label class="block font-semibold mb-2" style="color: var(--primary-green);">
              <i class="fas fa-map-pin mr-2"></i>Ph∆∞·ªùng/X√£
            </label>
            <input type="text" id="inputWard" class="form-control" placeholder="Nh·∫≠p ph∆∞·ªùng/x√£">
          </div>
        </div>
        <div class="flex justify-end space-x-3 pt-4">
          <button type="button" id="cancelAddressBtn" class="btn btn-outline-secondary">
            <i class="fas fa-times mr-2"></i>H·ªßy
          </button>
          <button type="button" id="saveAddressBtn" class="btn btn-success">
            <i class="fas fa-save mr-2"></i>L∆∞u ƒë·ªãa ch·ªâ
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal th√¥ng b√°o thanh to√°n th√†nh c√¥ng -->
  <div id="paymentSuccessModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 px-4">
    <div class="modal-content w-full max-w-md">
      <div class="text-center p-8">
        <div class="mb-6">
          <i class="fas fa-check-circle text-6xl" style="color: var(--accent-green);"></i>
        </div>
        <h3 class="text-2xl font-bold mb-4" style="color: var(--primary-green);">
          Thanh to√°n th√†nh c√¥ng!
        </h3>
        <p class="text-lg mb-6" style="color: var(--text-dark);">
          ƒê∆°n h√†ng c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c thanh to√°n th√†nh c√¥ng
        </p>
        <button id="backToCartFromSuccessBtn" class="btn-success w-full mt-8 py-4 rounded-xl">
          <i class="fas fa-shopping-cart mr-2"></i>
          Ti·∫øp t·ª•c mua s·∫Øm
        </button>
      </div>
    </div>
  </div>

  <script>
    const addAddressBtn = document.getElementById('addAddressBtn');
    const addressModal = document.getElementById('addressModal');
    const closeModalBtn = document.getElementById('closeModalBtn');
    const cancelAddressBtn = document.getElementById('cancelAddressBtn');
    const saveAddressBtn = document.getElementById('saveAddressBtn');
    const addressContainer = document.getElementById('addressList');

    addAddressBtn?.addEventListener('click', () => {
      addressModal.classList.remove('hidden');
      addressModal.classList.add('flex');
    });

    [closeModalBtn, cancelAddressBtn].forEach(btn => {
      btn?.addEventListener('click', () => {
        addressModal.classList.remove('flex');
        addressModal.classList.add('hidden');
      });
    });

    // Ki·ªÉm tra h·ªç v√† t√™n: t·ªëi ƒëa 50 k√Ω t·ª±, kh√¥ng k√Ω t·ª± ƒë·∫∑c bi·ªát, ch·ªØ c√°i ƒë·∫ßu vi·∫øt hoa, ti·∫øng Vi·ªát c√≥ d·∫•u
function validateFullName(name) {
  name = name.trim();
  if (name.length === 0 || name.length > 50) {
    alert("T√™n kh√¥ng h·ª£p l·ªá");
    return false;
  }
  // Cho ph√©p ch·ªØ hoa ti·∫øng Vi·ªát ƒë·∫ßu t·ª´, c√°c k√Ω t·ª± c√≤n l·∫°i l√† th∆∞·ªùng ho·∫∑c d·∫•u nh√°y ƒë∆°n, nhi·ªÅu t·ª´ c√°ch nhau b·ªüi 1 kho·∫£ng tr·∫Øng
  const regex = /^([A-Z√Ä√Å√Ç√É√Ñ√ÖƒÄƒÇƒÑ·∫†·∫¢·∫§·∫¶·∫®·∫™·∫¨·∫Æ·∫∞·∫≤·∫¥·∫∂√Ü√áƒÜƒàƒäƒåƒê√ê√à√â√ä√ãƒíƒîƒñƒòƒö·∫∏·∫∫·∫º·∫æ·ªÄ·ªÇ·ªÑ·ªÜ√å√ç√é√èƒ®ƒ™ƒÆƒ∞·ªà·ªä√ë√í√ì√î√ï√ñ√ò≈å≈é≈ê∆†·ªå·ªé·ªê·ªí·ªî·ªñ·ªò·ªö·ªú·ªû·ª†·ª¢√ô√ö√õ√ú≈®≈™≈¨≈Æ≈∞≈≤∆Ø·ª§·ª¶·ª®·ª™·ª¨·ªÆ·ª∞√ù≈∏·ª≤·ª¥·ª∂·ª∏][a-z√†√°√¢√£√§√•ƒÅƒÉƒÖ·∫°·∫£·∫•·∫ß·∫©·∫´·∫≠·∫Ø·∫±·∫≥·∫µ·∫∑√¶√ßƒáƒâƒãƒçƒë√∞√®√©√™√´ƒìƒïƒóƒôƒõ·∫π·∫ª·∫Ω·∫ø·ªÅ·ªÉ·ªÖ·ªá√¨√≠√Æ√Øƒ©ƒ´ƒØi·ªâ·ªã√±√≤√≥√¥√µ√∂√∏≈ç≈è≈ë∆°·ªç·ªè·ªë·ªì·ªï·ªó·ªô·ªõ·ªù·ªü·ª°·ª£√π√∫√ª√º≈©≈´≈≠≈Ø≈±≈≥∆∞·ª•·ªß·ª©·ª´·ª≠·ªØ·ª±√Ω√ø·ª≥·ªµ·ª∑·ªπ']*)(\s([A-Z√Ä√Å√Ç√É√Ñ√ÖƒÄƒÇƒÑ·∫†·∫¢·∫§·∫¶·∫®·∫™·∫¨·∫Æ·∫∞·∫≤·∫¥·∫∂√Ü√áƒÜƒàƒäƒåƒê√ê√à√â√ä√ãƒíƒîƒñƒòƒö·∫∏·∫∫·∫º·∫æ·ªÄ·ªÇ·ªÑ·ªÜ√å√ç√é√èƒ®ƒ™ƒÆƒ∞·ªà·ªä√ë√í√ì√î√ï√ñ√ò≈å≈é≈ê∆†·ªå·ªé·ªê·ªí·ªî·ªñ·ªò·ªö·ªú·ªû·ª†·ª¢√ô√ö√õ√ú≈®≈™≈¨≈Æ≈∞≈≤∆Ø·ª§·ª¶·ª®·ª™·ª¨·ªÆ·ª∞√ù≈∏·ª≤·ª¥·ª∂·ª∏][a-z√†√°√¢√£√§√•ƒÅƒÉƒÖ·∫°·∫£·∫•·∫ß·∫©·∫´·∫≠·∫Ø·∫±·∫≥·∫µ·∫∑√¶√ßƒáƒâƒãƒçƒë√∞√®√©√™√´ƒìƒïƒóƒôƒõ·∫π·∫ª·∫Ω·∫ø·ªÅ·ªÉ·ªÖ·ªá√¨√≠√Æ√Øƒ©ƒ´ƒØi·ªâ·ªã√±√≤√≥√¥√µ√∂√∏≈ç≈è≈ë∆°·ªç·ªè·ªë·ªì·ªï·ªó·ªô·ªõ·ªù·ªü·ª°·ª£√π√∫√ª√º≈©≈´≈≠≈Ø≈±≈≥∆∞·ª•·ªß·ª©·ª´·ª≠·ªØ·ª±√Ω√ø·ª≥·ªµ·ª∑·ªπ']*))*$/u;
  if (!regex.test(name)) {
    alert("T√™n kh√¥ng h·ª£p l·ªá");
    return false;
  }
  return true;
}

// Ki·ªÉm tra s·ªë ƒëi·ªán tho·∫°i: b·∫Øt ƒë·∫ßu b·∫±ng 0, 10 ch·ªØ s·ªë, ch·ªâ s·ªë
function validatePhoneNumber(phone) {
  phone = phone.trim();
  if (!/^0\d{9}$/.test(phone)) {
    alert("s·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá");
    return false;
  }
  return true;
}

    saveAddressBtn?.addEventListener('click', () => {
      const nickname = document.getElementById('inputNickname').value.trim();
      const name = document.getElementById('inputName').value.trim();
      const phone = document.getElementById('inputPhone').value.trim();
      const address = document.getElementById('inputAddress').value.trim();
      const city = document.getElementById('inputCity').value.trim();
      const ward = document.getElementById('inputWard').value.trim();

      if (!name || !phone || !address || !city || !ward) {
        alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin.');
        return;
      }

      if (!validateFullName(name)) return;
      if (!validatePhoneNumber(phone)) return;

      const wrapper = document.createElement('div');
      wrapper.className = 'address-card p-6 rounded-xl cursor-pointer animate-fade-in';
      
      // T·∫°o n·ªôi dung hi·ªÉn th·ªã v·ªõi t√™n g·ª£i nh·ªõ (n·∫øu c√≥)
      const nicknameDisplay = nickname ? `
        <p class="text-2xl font-bold mb-3" style="color: var(--primary-green);">
          ${nickname}
        </p>
      ` : '';
      
      wrapper.innerHTML = `
        <div class="flex justify-between items-start">
          <label class="flex items-start space-x-4 flex-1 cursor-pointer">
            <input type="radio" name="address" class="h-6 w-6 text-green-600 mt-1">
            <div class="flex-1">
              ${nicknameDisplay}
              <p class="text-xl font-semibold mb-2" style="color: var(--primary-green);">
                <i class="fas fa-user mr-2" style="color: var(--accent-green);"></i>${name}
              </p>
              <div class="space-y-1" style="color: var(--text-dark);">
                <p class="flex items-center">
                  <i class="fas fa-phone mr-2 w-4" style="color: var(--accent-green);"></i>${phone}
                </p>
                <p class="flex items-center">
                  <i class="fas fa-map-marker-alt mr-2 w-4" style="color: var(--accent-green);"></i>${address}, ${ward}, ${city}
                </p>
              </div>
            </div>
          </label>
          <button type="button" class="delete-btn delete-address-btn ml-4">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      `;
      addressContainer.appendChild(wrapper);

      addressModal.classList.remove('flex');
      addressModal.classList.add('hidden');
      document.getElementById('addressForm').reset();

      setupAddressCardEvents();
    });

    function setupAddressCardEvents() {
      const addressCards = document.querySelectorAll('.address-card');
      addressCards.forEach(card => {
        const radio = card.querySelector('input[type="radio"]');
        const deleteBtn = card.querySelector('.delete-address-btn');

        card.onclick = null;
        if (deleteBtn) deleteBtn.onclick = null;

        card.addEventListener('click', () => {
          addressCards.forEach(c => {
            c.classList.remove('selected');
            c.querySelector('input[type="radio"]').checked = false;
          });
          card.classList.add('selected');
          radio.checked = true;
        });

        if (deleteBtn) {
          deleteBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            card.style.animation = 'fadeInUp 0.3s ease reverse';
            setTimeout(() => card.remove(), 300);
          });
        }
      });
    }

    // Payment method selection
    document.querySelectorAll('.payment-method').forEach(method => {
      method.addEventListener('click', () => {
        document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('selected'));
        method.classList.add('selected');
        method.querySelector('input[type="radio"]').checked = true;
      });
    });

    // X·ª≠ l√Ω n√∫t quay l·∫°i gi·ªè h√†ng
    document.getElementById('backToCartBtn').addEventListener('click', () => {
      window.location.href = 'GIOHANG2.html';
    });

    // X·ª≠ l√Ω ho√†n t·∫•t ƒë∆°n h√†ng
    document.getElementById('completeOrderBtn').addEventListener('click', () => {
      const orderItems = JSON.parse(localStorage.getItem('orderItems')) || [];
      
      if (orderItems.length === 0) {
        alert('Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o ƒë·ªÉ thanh to√°n!');
        return;
      }

      // Ki·ªÉm tra ƒë·ªãa ch·ªâ giao h√†ng
      const selectedAddress = document.querySelector('input[name="address"]:checked');
      if (!selectedAddress) {
        alert('Vui l√≤ng ch·ªçn ƒë·ªãa ch·ªâ giao h√†ng!');
        return;
      }

      // Ki·ªÉm tra ph∆∞∆°ng th·ª©c thanh to√°n
      const selectedPayment = document.querySelector('input[name="payment"]:checked');
      if (!selectedPayment) {
        alert('Vui l√≤ng ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n!');
        return;
      }

      // X√≥a c√°c s·∫£n ph·∫©m ƒë√£ thanh to√°n kh·ªèi gi·ªè h√†ng
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      const cartSelected = JSON.parse(localStorage.getItem('cartSelected')) || [];
      
      // L·ªçc ra nh·ªØng s·∫£n ph·∫©m ch∆∞a ƒë∆∞·ª£c ch·ªçn ƒë·ªÉ thanh to√°n
      const remainingCart = cart.filter((_, index) => !cartSelected.includes(index));
      
      // C·∫≠p nh·∫≠t l·∫°i gi·ªè h√†ng v√† selection
      localStorage.setItem('cart', JSON.stringify(remainingCart));
      localStorage.setItem('cartSelected', JSON.stringify([]));
      
      // X√≥a th√¥ng tin ƒë∆°n h√†ng t·∫°m
      localStorage.removeItem('orderItems');
      
      // Hi·ªán modal th√†nh c√¥ng
      const successModal = document.getElementById('paymentSuccessModal');
      successModal.classList.remove('hidden');
      successModal.classList.add('flex');
    });

    // X·ª≠ l√Ω n√∫t quay l·∫°i t·ª´ modal th√†nh c√¥ng
    document.getElementById('backToCartFromSuccessBtn').addEventListener('click', () => {
      window.location.href = 'GIOHANG2.html';
    });

    // Th√™m hi·ªáu ·ª©ng hover cho n√∫t quay l·∫°i
    const backBtn = document.getElementById('backToCartBtn');
    backBtn.addEventListener('mouseenter', () => {
      backBtn.style.background = 'rgba(200, 230, 201, 0.6)';
      backBtn.style.borderColor = 'var(--accent-green)';
      backBtn.style.transform = 'translateX(-5px)';
    });

    backBtn.addEventListener('mouseleave', () => {
      backBtn.style.background = 'rgba(232, 245, 232, 0.5)';
      backBtn.style.borderColor = 'var(--border-green)';
      backBtn.style.transform = 'translateX(0)';
    });

    function formatVND(n) {
      return n.toLocaleString('vi-VN') + '‚Ç´';
    }

    const container = document.getElementById('orderItemsContainer');
    const orderItems = JSON.parse(localStorage.getItem('orderItems')) || [];

    if (orderItems.length === 0) {
      container.innerHTML = '<div class="text-center py-8"><i class="fas fa-shopping-cart text-4xl mb-4" style="color: var(--accent-green);"></i><p class="text-gray-500">Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o trong ƒë∆°n h√†ng.</p></div>';
    } else {
      let subtotal = 0;
      container.innerHTML = orderItems.map(item => {
        const itemTotal = item.price * item.quantity;
        subtotal += itemTotal;
        return `
          <div class="product-item flex items-center">
            <div class="w-20 h-20 bg-gradient-to-br from-green-50 to-green-100 rounded-xl overflow-hidden mr-4 flex items-center justify-content border-2" style="border-color: var(--border-green);">
              <img src="https://placehold.co/80x80?text=üåø" alt="Product" class="w-full h-full object-contain" />
            </div>
            <div class="flex-1">
              <p class="font-semibold text-lg mb-1" style="color: var(--primary-green);">${item.name}</p>
              <div class="flex justify-between items-center">
                <p class="text-sm" style="color: var(--text-dark); opacity: 0.8;">
                  <i class="fas fa-box mr-1" style="color: var(--accent-green);"></i>${item.quantity} x ${formatVND(item.price)}
                </p>
                <p class="font-bold text-lg" style="color: var(--accent-green);">${formatVND(itemTotal)}</p>
              </div>
            </div>
          </div>`;
      }).join('');

      // C·∫≠p nh·∫≠t t·ªïng ti·ªÅn
      document.querySelectorAll('.order-summary p')[1].textContent = formatVND(subtotal);
      document.querySelectorAll('.order-summary p')[5].textContent = formatVND(subtotal + 30000);
    }
  </script>
</body>
</html>
  </script>
</body>
</html>

